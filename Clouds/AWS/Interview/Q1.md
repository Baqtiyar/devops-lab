## AWS S3 ‚Äì Access Denied When Uploading Files

### üìå Question:
A developer reports that they are receiving an **"Access Denied"** error when trying to upload files to an S3 bucket using a CI/CD pipeline. The pipeline was working fine previously. You are asked to investigate and resolve the issue. What steps will you take?

---

### üß† Answer:

To troubleshoot an S3 `AccessDenied` error, I would follow these steps:

---

### üîç Step-by-Step Investigation:

1. **Check the error message details:**
   - From the pipeline logs or AWS CLI:
     ```
     An error occurred (AccessDenied) when calling the PutObject operation: Access Denied
     ```

2. **Verify the IAM role or user credentials used by the pipeline:**
   - If it‚Äôs a service role or user:
     ```bash
     aws sts get-caller-identity
     ```
   - Make sure the pipeline is using the correct AWS identity (not expired or wrong).

3. **Check IAM permissions:**
   - Navigate to IAM Console ‚Üí Role/User ‚Üí Permissions tab.
   - Confirm that the policy attached allows `s3:PutObject` for the bucket:
     ```json
     {
       "Effect": "Allow",
       "Action": "s3:PutObject",
       "Resource": "arn:aws:s3:::your-bucket-name/*"
     }
     ```

4. **Check the S3 bucket policy:**
   - Go to the bucket ‚Üí Permissions ‚Üí Bucket Policy.
   - Ensure it allows access for the IAM role or user.
   - Watch out for conflicting `Deny` statements.

5. **Check if Object Ownership or Block Public Access is enforced:**
   - Sometimes new S3 settings (Object Ownership, ACLs) can block access.
   - Make sure you're not trying to use ACLs if bucket disables them.

6. **Test access manually (optional):**
   - Try uploading a file with the same credentials:
     ```bash
     aws s3 cp test.txt s3://your-bucket-name/
     ```

7. **Look at recent IAM or bucket policy changes:**
   - Use AWS CloudTrail or ask the team if permissions were recently modified.

---

### ‚úÖ Fix Examples:

- Update IAM role with missing permissions:
  ```json
  {
    "Effect": "Allow",
    "Action": [
      "s3:PutObject",
      "s3:GetObject",
      "s3:ListBucket"
    ],
    "Resource": [
      "arn:aws:s3:::your-bucket-name",
      "arn:aws:s3:::your-bucket-name/*"
    ]
  }
  ```

- Or fix the bucket policy to allow that IAM role to upload objects.


